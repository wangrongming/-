import requests
# import glom
import json
import ssl

ssl._create_default_https_context = ssl._create_unverified_context

headers = dict()
headers["Host"] = "m.weibo.cn"
headers["Connection"] = "keep-alive"
headers["Accept"] = "application/json, text/plain, */*"
headers["Accept-Encoding"] = "gzip, deflate, br"
headers["Accept-Language"] = "zh-CN,zh;q=0.9"
headers[
    "User-Agent"] = "Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1"
headers["X-Requested-With"] = "XMLHttpRequest"

headers["MWeibo-Pwa"] = "1"
headers["Referer"] = "https://m.weibo.cn/detail/4435317559653821"
headers["X-XSRF-TOKEN"] = "3e17df"

headers["Sec-Fetch-Mode"] = "cors"
headers["Sec-Fetch-Site"] = "same-origin"

headers[
    "Cookie"] = f"_T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; " \
    f"SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; " \
    f"SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; " \
    f"SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; " \
    f"SUHB=0auAWXElIp4ExY; " \
    f"M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; " \
    f"XSRF-TOKEN={headers['X-XSRF-TOKEN']}"

print(headers["Cookie"])
# session = requests.session()
# session.keep_alive = False

max_id = "4435349159373222"
url = f"https://m.weibo.cn/comments/hotflow?id=4435317559653821&mid=4435317559653821&max_id={max_id}&max_id_type=1"
# url = "https://m.weibo.cn/comments/hotflow?id=4434627185431944&mid=4434627185431944&max_id=139251596951410&max_id_type=0"
print(url)
headers = {
    'Host': 'm.weibo.cn',
    'Connection': 'keep-alive',
    'Cache-Control': 'max-age=0',
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1',
    'Sec-Fetch-Mode': 'same-origin',
    'Sec-Fetch-Site': 'same-origin',
    'Accept-Encoding': 'gzip, deflate, br',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Cookie': '_T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; XSRF-TOKEN=3e17df',
}
response = requests.get(url, headers=headers, verify=False)
text = response.text

print(text)

dic = json.loads(text)

# if glom.glom(dic, "ok") == 1:
#     data = glom.glom(dic, "data.data")
# print(data)

# session.close()

# res = text.encode('utf-8', 'ignore').decode("unicode_escape")

# print(requests.get("https://www.baidu.com", verify=False).text)

# Cookie: _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=468602
# s1 = "#Cookie: _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=09569d"
# s2 = "#Cookie: _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=09569d"
#        Cookie: _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=31720b
#                _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=31720b
#                _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=aa02f7
# print(s1 == s2)
# _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; XSRF-TOKEN=bdc8a4
# _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821%26uicode%3D20000061%26fid%3D4435317559653821; XSRF-TOKEN=7f0fd5
# _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; XSRF-TOKEN=bdc8a4
# _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; XSRF-TOKEN=7f0fd5
# _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; XSRF-TOKEN=3e17df
# _T_WM=41865154571; WEIBOCN_FROM=1110003030; ALF=1575539754; SCF=AsYvYyV4LERRwHF2HUXyUKRmTrN3f2pUyZYWXwzKi2o3fd2TJytM_OAiKAbxX1im-Xp9IwTRlwwzkffEGk1d6-c.; SUBP=0033WrSXqPxfM725Ws9jqgMF55529P9D9WhdKOILeodghKXNcUWSfsT-5JpX5K-hUgL.FoqNeh-feonN1KM2dJLoI7fNIs8XMcvLUJHEMc_4; SSOLoginState=1572947762; MLOGIN=1; SUB=_2A25wxTcVDeRhGeBJ61cU8ibLwjuIHXVQRlldrDV6PUJbkdANLVfQkW1NRnUXEX7Ckv0QH-JBTx3gV0M4S7QyEqY3; SUHB=0auAWXElIp4ExY; M_WEIBOCN_PARAMS=oid%3D4435317559653821%26luicode%3D20000061%26lfid%3D4435317559653821; XSRF-TOKEN=3e17df
